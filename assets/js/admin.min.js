!function(a){function b(){var b=a(".wpcw-widget .form").not(".wpcw-widget-hours .form");b.sortable({items:"> *:not(.not-sortable)",handle:".wpcw-widget-sortable-handle",containment:"parent",placeholder:"sortable-placeholder",axis:"y",tolerance:"pointer",forcePlaceholderSize:!0,cursorAt:{top:40},stop:function(a,c){b.find(".customizer_update").val(c.item.index()).trigger("change")}})}function c(){a(".timeselect").timepicker({timeFormat:wpcw_admin.time_format});var b={changeTime:function(){a(this).attr("value",a(this).val())},showPicker:function(){a(".ui-timepicker-wrapper").css("width",a(this).innerWidth()+"px")}};a(".timeselect").on("changeTime",b.changeTime),a(".timeselect").on("showTimepicker",b.showPicker)}a.fn.selectString=function(b){var c=a(this)[0],d=c.value.indexOf(b),e=d+b.length;if(c&&!(0>d))if(c.setSelectionRange)c.focus(),c.setSelectionRange(d,e);else if(c.createTextRange){var f=c.createTextRange();f.collapse(!0),f.moveEnd("character",e),f.moveStart("character",d),f.select()}else c.selectionStart&&(c.selectionStart=d,c.selectionEnd=e)};var d={$btn:null,$widget:null,$template:null,init:function(b){b.preventDefault();var c=d;return c.$btn=a(this),c.$widget=c.$btn.parents(".wpcw-widget"),c.$widget.find("."+c.$btn.data("key")).is(":animated")?!1:c.$btn.hasClass("inactive")?(c.$template=c.$widget.find(".default-fields"),c.$template=a(a.trim(c.$template.clone().html())),void c.add()):void c.remove()},add:function(){this.$btn.removeClass("inactive");var a=this.$btn.data();this.$template.addClass(a.key).find("label").prop("for",a.id),this.$template.find("input").prop("id",a.id).prop("name",a.name).prop("value",a.value),this.$template.find("label span.fa").prop("class",this.$btn.find("i").attr("class")),this.$template.find("label span.text").text(a.label),this.$template.hide().prependTo(this.$widget.find(".form")).stop(!0,!0).animate({height:"toggle",opacity:"toggle"},250),this.$template.find("input").selectString(a.select),this.update_customizer()},remove:function(){this.$btn.addClass("inactive"),this.$widget.find(".form ."+this.$btn.data("key")).stop(!0,!0).animate({height:"toggle",opacity:"toggle"},250,function(){a(this).remove()}),this.update_customizer()},update_customizer:function(){var a=this.$widget.find("div > div").length;this.$widget.find(".customizer_update").val(a).trigger("change")}},e={toggle:function(b){b.preventDefault();var c=a(this).closest(".day-row"),d=c.find(".day-row-container");if(d.is(":animated"))return!1;var e=c.find(".toggle-icon"),f=c.hasClass("active");f||e.toggleClass("dashicons-arrow-down").toggleClass("dashicons-arrow-up"),d.slideToggle("fast",function(){f&&e.toggleClass("dashicons-arrow-down").toggleClass("dashicons-arrow-up"),c.toggleClass("active")})},maybeBlockSelect:function(b){var c=a(this).closest(".day-row");c.hasClass("status-closed")&&b.preventDefault()},addBlock:function(b){if(b.preventDefault(),a(this).hasClass("disabled"))return!1;var d=a(this).closest(".time-block"),f=e.cloneTimeBlock(d,d.parent());f.find("a.button").attr("data-action","remove").text("-"),a(this).hide(),c()},removeBlock:function(b){if(b.preventDefault(),a(this).hasClass("disabled"))return!1;var c=a(this).closest(".time-block");c.prev(".time-block").find("a.button").show(),c.remove()},applyToAll:function(b){b.preventDefault();var d=a(this).closest(".day-row"),f=d.closest(".wpcw-widget"),g=f.find(".day-row").filter(function(){return a(this).is(":animated")});if(g.length>0)return!1;d.hasClass("status-closed")?f.find(".status-closed-checkbox input:not(:checked)").not(this).trigger("click"):f.find(".status-closed-checkbox input:checked").not(this).trigger("click");var h=d.find(".time-block");f.find(".day-row").not(d).each(function(){var b=a(this).find(".time-blocks");b.empty(),h.each(function(){e.cloneTimeBlock(a(this),b,!0,!0)})}),c()},cloneTimeBlock:function(b,c,d,e){var f=b.closest(".day-row"),g=parseInt(f.attr("data-day"),10),h=parseInt(c.closest(".day-row").attr("data-day"),10),i=parseInt(b.attr("data-time-block"),10),j=c.is(":empty")?0:parseInt(c.find(".time-block").last().attr("data-time-block"),10)+1,d=d||!1,e=e||!1,k=b.clone(d),l=k.html(),m="\\[schedule\\]\\["+g+"\\]\\[blocks\\]\\["+i+"\\]",n="[schedule]["+h+"][blocks]["+j+"]",o="schedule-"+g+"-blocks-"+i,p="schedule-"+h+"-blocks-"+j;return l=l.replace(new RegExp(m,"g"),n),l=l.replace(new RegExp(o,"g"),p),k=k.html(l),d&&k.find("select").each(function(){var c=a(this).attr("class").split(" ").map(function(a){return a.trim()}).join(".");a(this).val(b.find("select."+c).val())}),c.append(k),k.attr("data-time-block",j),e&&k.closest(".day-row").fadeTo(50,.1,function(){a(this).fadeTo(500,1)}),k},toggleClosed:function(){var b=a(this).closest(".day-row"),c=b.hasClass("status-closed");b.toggleClass("status-closed").toggleClass("status-open"),b.find("a.button").toggleClass("disabled",!c),b.find(".timeselect").toggleClass("disabled",!c)}};a(document).ready(function(a){c(),a(document).on("click",".wpcw-widget-social .icons a",d.init),a(document).on("click",".wpcw-widget-hours .day-row-top",e.toggle),a(document).on("mousedown",".wpcw-widget-hours .time-block select",e.maybeBlockSelect),a(document).on("click",'.wpcw-widget-hours .time-block a.button[data-action="add"]',e.addBlock),a(document).on("click",'.wpcw-widget-hours .time-block a.button[data-action="remove"]',e.removeBlock),a(document).on("click",".wpcw-widget-hours .apply-to-all",e.applyToAll),a(document).on("change",".wpcw-widget-hours .status-closed-checkbox input",e.toggleClosed),a(document).on("wpcw.change",b),a(document).on("click.widgets-toggle",b),a(document).on("widget-updated",function(){b(),c()})})}(jQuery);